LPVault={},function(e,t,n){var i=Strings.translateString("Folder (a-z)"),o=Strings.translateString("Folder (z-a)"),r=Strings.translateString("Name (a-z)"),s=Strings.translateString("Name (z-a)"),a=Strings.translateString("Most Recent"),l=Strings.translateString("Sender (a-z)"),c=Strings.translateString("Sender (z-a)"),u=Strings.translateString("Recipient (a-z)"),d=Strings.translateString("Recipient (z-a)"),p=[i,o,r,s,a],g=[r,s],m=[r,s,u,d,a],f=[r,s,l,c,a],h=[r,s],P=[r,s],y=function(e){this.options=e};y.prototype.getAddElement=function(){return void 0===this.addElement&&(this.addElement=LPTools.createElement("div","addMenuItem"),this.build(this.addElement,this.options.icon?this.options.icon:"images/vault_4.0/Add.png")),this.addElement},y.prototype.build=function(e,t){e.appendChild(LPTools.createElement("span",null,Strings.Vault[this.options.text]));var n=LPTools.createElement("div"),i=LPTools.createElement("div"),o=LPTools.createElement("img",{src:t});e.appendChild(n),n.appendChild(i),i.appendChild(o),$(e).bind("click",this.options.func)},y.prototype.getMenuElement=function(){return void 0===this.menuElement&&(this.menuElement=LPTools.createElement("li","addMenuItem"),this.build(this.menuElement,this.options.additionalIcon)),this.menuElement};var v={Site:new y({text:"ADD_SITE",icon:"images/vault_4.0/Sites_Active.png",func:function(){t.openSiteDialog({saveOptions:{source:"vault"}})}}),Note:new y({text:"ADD_NOTE",icon:"images/vault_4.0/Notes_Active.png",additionalIcon:"images/vault_4.0/Add_Secure_Note.png",func:function(){t.openNoteDialog({saveOptions:{source:"vault"}})}}),FormFill:new y({text:"ADD_FORM_FILL",icon:"images/vault_4.0/Form_Fills_Active.png",func:function(){t.openFormFillDialog({saveOptions:{source:"vault"}})}}),SharedFolder:new y({text:"ADD_SHARED_FOLDER",func:function(){t.openCreateSharedFolderDialog()}}),Identity:new y({text:"ADD_IDENTITY",func:function(){t.openIdentityDialog()}}),EmergencyAccess:new y({text:"GIVE_EMER_ACCESS",func:function(){LPProxy.getUser().isFreeOrTrial()&&LPFeatures.restrictEmergencyAccessForFree()?dialogs.restrictedEmergencyAccess.open():dialogs.addEmergencyAccess.open()}}),CreditMonitoring:new y({text:"ADD_CREDIT_MON",func:function(){t.openCreateCreditMonitoringDialog()}}),Folder:new y({text:"ADD_FOLDER",additionalIcon:"images/vault_4.0/Add_Folder.png",func:function(){t.openFolderDialog()}}),ShareItems:new y({text:"SHARE_ITEMS",additionalIcon:"images/vault_4.0/Add_Share.png",func:function(){t.openShareDialog()}})},S=Strings.translateString("search my vault"),E=null,b=$("#advacedOptionsOverlay"),L=$("#inProgressOverlay"),T=$("#tools"),I=$("#options"),C=$("#mainScroll"),_=$("#addMenu"),D=$("#addMenuItems"),A=$("#addMenuButton"),F=$("#addMenuButtonCustom"),w=$("#gridButton"),M=$("#listButton"),O=$("#collapseAllToggle"),k=$("#sizeToggle"),x=$("#orderOption"),R=$("#sortOrderMenu"),B=$("#sortOrderOption"),N=$("#userMenuItems"),G=$("#leftMenuMinimizeButton"),U=$("#moreActions"),z=e.getElementById("contextMenu").parentElement,V=$(e.body),H=$("#advancedMenuItem"),Y=e.getElementById("sortOrderMenu").children[0],q=$("#vaultSearch"),j=$("#userMenuContainer"),W=$("#pageTitle"),K=null,X=null,Q=!0,Z=null,J=null,ee=null,te=function(e,t){ee.getContainer()===t&&(ee.removeBodyState(),ee.addBodyState())},ne=function(e){var t;e=e||{},this.state=e.bodyState,this.menuElement=e.menuElement||null,this.emptyState=this.state+"Empty",this.container=null,this.sortOptions=e.sortOptions||null,this.persistent=LPTools.getOption(e,"persistent",!0),this.searchPlaceholder=LPTools.getOption(e,"searchPlaceholder",S),this.title=e.title||"",this.addMenu=e.addMenu,this.additionalOptionButtons=e.additionalOptionButtons,this.scrollParent=e.scrollParent,this.notificationCount=e.notificationCount,t=this,Topics.get(Topics.CLEAR_DATA).subscribe(function(){t.clear()}),e.menuElement&&e.menuElement.unbind("click.menu").bind("click.menu",function(){t.parent?t.parent.show(t):t.show()})};ne.prototype.getElement=function(){return this.menuElement.get(0)},ne.prototype.applyContainerFunction=function(e){var t=this.getContainer();if(null!==t)switch(typeof e){case"string":var n=[];if(arguments.length>1)for(var i=1,o=arguments.length;i<o;++i)n.push(arguments[i]);return t[e].apply(t,n);case"function":return e(t)}},ne.prototype.updateNotificationCount=function(e){var t=0,n=this.menuElement.find(".tabNotification");return void 0!==e?(t=parseInt(n.text()),Ue(n,t-e),this.parent&&this.parent.updateNotificationCount(e)):this.notificationCount&&(t=this.notificationCount(),Ue(n,t)),t},ne.prototype.getSortOptions=function(){return this.sortOptions},ne.prototype.getContainer=function(){return this.container},ne.prototype.setContainer=function(e,n){this.container=e,e&&(e._buildOptions.stateChangeCallback=te,LPTools.getOption(n,"checkForStateChange",!0)&&ee===this&&te(e.isEmpty(),e),ee===this&&""!==q.val()&&t.search(q.val()))},ne.prototype.openAll=function(){this.applyContainerFunction("openAll")},ne.prototype.collapseAll=function(){this.applyContainerFunction("collapseAll")},ne.prototype.createSelectionContextMenu=function(){return this.applyContainerFunction("createSelectionContextMenu")},ne.prototype.isEmpty=function(){return this.applyContainerFunction("isEmpty")},ne.prototype.search=function(e){var t=this.applyContainerFunction("applySearch",e);e&&null===t&&!this.isEmpty()?V.addClass("searchEmpty"):V.removeClass("searchEmpty")},ne.prototype.clearSelected=function(){this.applyContainerFunction("clearSelected")},ne.prototype.getSelectedItems=function(){return this.applyContainerFunction("getSelectedItems")},ne.prototype.getSortOrder=function(){if(void 0===this.sortOrder){var e=this.sortOptions?this.sortOptions[0]:null;this.sortOrder=LPProxy.getPreference(this.state+"SortOrder",e)}return this.sortOrder},ne.prototype.setSortOrder=function(e){this.sortOrder=e,LPProxy.setPreferences(this.state+"SortOrder",e)},ne.prototype.addBodyState=function(){V.addClass(this.getState());var e=this.getContainer();null!==e&&e.isEmpty()&&0===oneMinuteSignup.getReminderCount()?V.addClass("empty"):V.removeClass("empty"),setTimeout(function(){Topics.get(Topics.EMPTY_VAULT_STATE_CHANGE).publish()},400)},ne.prototype.removeBodyState=function(){V.removeClass(this.emptyState),V.removeClass(this.state)},ne.prototype.hide=function(){if(null!==this.menuElement&&this.menuElement.removeClass("selected"),this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.removeClass("selected"),this.removeBodyState(),this.additionalOptionButtons)for(var e=0,t=this.additionalOptionButtons.length;e<t;++e)this.additionalOptionButtons[e].detach();this.persistent?this.applyContainerFunction("hide"):this.clear()},ne.prototype.getAddMenuItems=function(){var e=[];if(this.addMenu&&this.addMenu.length>0)for(var t=0,n=this.addMenu.length;t<n;++t){var i=this.addMenu[t];(i!==v.ShareItems||LPFeatures.allowIndividualSharing())&&(i!==v.Note||LPFeatures.allowNotes())&&e.push(i)}return e},ne.prototype.show=function(){if(ee!==this){null!==ee&&(Le(),ee.hide()),q.attr("placeholder",this.searchPlaceholder),null!==this.menuElement&&this.menuElement.addClass("selected"),this.parent&&null!==this.parent.menuElement&&this.parent.menuElement.addClass("selected"),W.text(this.title),this.addBodyState(),this.scrollParent.scrollTop(0);var e=this.getSortOptions();null!==ee&&ee.getSortOptions()===e||Ie(e),ee=this;var n=this.getSortOrder();n&&t.sort(n),this.additionalOptionButtons&&I.append(this.additionalOptionButtons),D.children().detach(),F.children().detach();var i=this.getAddMenuItems();if(i.length>0){var o=i[0];F.append(o.getAddElement());for(var r=i.length-1;r>0;--r)D.append(i[r].getMenuElement());A.show()}else A.hide();LPProxy.getPreference("leftMenuMaximize")?t.maximizeLeftMenu():t.minimizeLeftMenu()}},ne.prototype.getState=function(){return this.isEmpty()?this.emptyState:this.state},ne.prototype.clear=function(){this.container&&(this.container.destruct(),this.container=null)};var ie=function(t){var n;t.bodyState=t.bodyState||t.contentID,ne.call(this,t),this.contentElement=e.getElementById(t.contentID),this.containerType=t.containerType,this.dataSource=t.dataFunction,this.buildOptions=t.buildOptions,this.filter=t.filter,n=this,Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(e){n.refresh(e)}),n.initializeCallback=function(e,t){var i=new n.containerType(e,n.buildOptions);i.initialize(n.contentElement,n.scrollParent),n.filter&&i.applyFilter(n.filter,{checkForStateChange:!1}),n.setContainer(i,{checkForStateChange:LPTools.getOption(t,"checkForStateChange",!1)}),Topics.get(Topics.DIALOG_LOADED).publish()}};(ie.prototype=Object.create(ne.prototype)).constructor=ie,ie.prototype.makeDataRequest=function(e,t){t.error=function(){Topics.get(Topics.DIALOG_LOADED).publish()},LPRequest.makeDataRequest(e,t)},ie.prototype.initialize=function(e,t){var n,i;null===this.container&&null!==this.containerType&&null!==this.dataSource&&(n=this,e=(i=e)?function(e,t){n.initializeCallback(e,t),i()}:n.initializeCallback,Topics.get(Topics.DIALOG_LOADING).publish(),this.dataSource.call(this,e,t))},ie.prototype.show=function(e){var t;null===this.container?(t=this).initialize(function(){e&&e(),ne.prototype.show.apply(t)}):(ne.prototype.show.apply(this),e&&e())},ie.prototype.refresh=function(e){null!==this.container&&(this.container.destruct(),this.container=null,this.initialize(null,{identity:e,checkForStateChange:!0}))};var oe=function(e){ne.call(this,e),this.setContainer(e.container||null),this.filter=e.filter};(oe.prototype=Object.create(ne.prototype)).constructor=oe,oe.prototype.show=function(){this.container.applyFilter(this.filter,{checkForStateChange:!1}),ne.prototype.show.apply(this,arguments)};var re,se=function(e){var t,n=null;if(e.views&&e.views.length>0){for(var i=0,o=e.views.length;i<o;++i)e.views[i].parent=this;this.show=function(t,i){t?(t.show(i),n=t):(null===n&&(n=e.defaultView()),n.show(i))},this.clear=function(){n=null},this.menuElement=e.menuElement;var r=e.menuElement.find(".notificationBubble");this.updateNotificationCount=function(e){Ue(r,parseInt(r.text())-e)};var s=function(){for(var t=0,n=0,i=e.views.length;n<i;++n)t+=e.views[n].updateNotificationCount();Ue(r,t)};Topics.get(Topics.LOGIN).subscribe(s),Topics.get(Topics.REFRESH_DATA).subscribe(s),t=this,Topics.get(Topics.CLEAR_DATA).subscribe(function(){t.clear()})}},ae=new ie({containerType:IdentityContainer,dataFunction:function(e){for(var t=[],n=0,i=E._identities.length;n<i;++n)t.push(E._identities[n].newDisplayObject());e(t)},sortOptions:P,contentID:"identityContent",bodyState:"identity",scrollParent:C,searchPlaceholder:Strings.translateString("search my identities"),buildOptions:{multiSelect:!1},title:Strings.translateString("Identities"),addMenu:[v.Identity]}),le=new ie({containerType:CreditMonitoringContainer,dataFunction:function(e,t){this.makeDataRequest(LPProxy.getCreditMonitoringData,{success:function(n){!function(e,t,n){for(var i=!0,o=[],r=0,s=t.length;r<s;++r){var a=t[r];"1"!==a.premium&&(i=!1),o.push(new CreditMonitoringProfile(a))}var l=$("#creditMonitoring .viewExplanation");i?(l.hide(),le.title=Strings.translateString("Premium Credit Monitoring")):(l.show(),le.title=Strings.translateString("Credit Monitoring")),e(o,n)}(e,n,t)}})},persistent:!1,contentID:"creditMonitoring",scrollParent:C,title:Strings.translateString("Credit Monitoring"),addMenu:[v.CreditMonitoring]}),ce=new ie({containerType:GridListContainer,dataFunction:function(e,t){this.makeDataRequest(LPProxy.getDeletedItems,{success:e})},filter:{showEmptyGroups:!1},sortOptions:p,contentID:"deletedItems",scrollParent:C,persistent:!1,searchPlaceholder:Strings.translateString("search my deleted items"),buildOptions:{allowDrag:!1,stickyFolders:!0,stickyFolderParent:e.getElementById("main")},title:Strings.translateString("Deleted Items"),additionalOptionButtons:[(re=LPTools.createElement("div",{class:"optionButton optionButtons",id:"purgeAllButton"},Strings.Vault.PURGE_ALL),LPPlatform.addEventListener(re,"click",function(){var e=ce.getContainer();if(e){var t=e.getItemModelChildren();t.length>0&&t[0].purge({itemsForAction:t})}}),$(re))]});ce.refresh=function(){};var ue,de,pe=new ie({containerType:EmergencyAccessRecipientContainer,dataFunction:function(e,t){this.makeDataRequest(LPProxy.getEmergencyAccessRecipientInfo,{success:e})},filter:{showEmptyGroups:!1},sortOptions:p,menuElement:$("#emergencyTrustedMenuItem"),contentID:"emergencyTrustedContainer",bodyState:"emergencyTrusted",scrollParent:C,persistent:!1,searchPlaceholder:Strings.translateString("search people I trust"),buildOptions:{allowDrag:!1},title:Strings.translateString("People I Trust"),addMenu:[v.EmergencyAccess]}),ge=new ie({containerType:EmergencyAccessSharerContainer,dataFunction:function(e,t){this.makeDataRequest(LPProxy.getEmergencyAccessSharerInfo,{success:e})},filter:{showEmptyGroups:!1},notificationCount:function(){var e=0,t=bg.get("g_emer_sharers");if(t)for(var n=0,i=t.length;n<i;++n)"0"===t[n].accepted&&++e;return e},sortOptions:p,menuElement:$("#emergencyTrustingMenuItem"),contentID:"emergencyTrusting",bodyState:"emergencyTrusting",scrollParent:C,persistent:!1,searchPlaceholder:Strings.translateString("search people who trust me"),buildOptions:{allowDrag:!1},title:Strings.translateString("People Who Trust Me")}),me=new se({menuElement:$("#emergencyAccessMenuItem"),defaultView:function(){return ge.notificationCount()>0?ge:pe},views:[pe,ge]}),fe=new ie({containerType:IndividualShareContainer,sortOptions:f,menuElement:$("#receivedSharesMenuItem"),contentID:"receivedSharesContent",bodyState:"receivedShares",scrollParent:C,persistent:!1,notificationCount:function(){return bg.get("g_pendings").length},searchPlaceholder:Strings.translateString("search my received shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,multiSelect:!1},title:Strings.translateString("Shared with Me"),addMenu:[v.ShareItems],dataFunction:(ue=function(e,t,n){var i=function(e){for(var t=LPProxy.getAllModelItems(),n=[],i=0,o=t.length;i<o;++i){var r=t[i],s=e[r.getID()];s&&"1"===s.state&&r instanceof AccountBase&&n.push(new AcceptedReceivedSharedItem(r,s))}return n}(e),o=function(e){for(var t=LPProxy.getPendingRecievedShares(),n=!1,i=0,o=t.length;i<o;++i){var r=t[i],s=e[r._model.getID()];s?r._model._shareData=s:n=!0}return n&&LPProxy.refreshSites(),t}(e);t(i.concat(o))},function(e,t){this.makeDataRequest(LPProxy.getReceivedShareData,{params:{url:document.location.href},success:function(t){ue(t,e)}})})}),he=new ie({containerType:IndividualShareContainer,sortOptions:m,menuElement:$("#sentSharesMenuItem"),contentID:"sentSharesContent",bodyState:"sentShares",scrollParent:C,persistent:!1,searchPlaceholder:Strings.translateString("search my sent shares"),buildOptions:{multiSelect:!1},filter:{showEmptyGroups:!1,multiSelect:!1},title:Strings.translateString("Shared with Others"),addMenu:[v.ShareItems],dataFunction:function(e,t){this.makeDataRequest(LPProxy.getSentShareData,{params:{},success:function(n){!function(e,t,n){for(var i=LPProxy.getAllModelItems(),o=[],r=0,s=i.length;r<s;++r){var a=i[r];o=o.concat(LPTools.buildSentShareItems(a,e[a.getID()]))}t(o,n)}(n,e,t)}})}}),Pe=new ie({containerType:SharedFolderContainer,dataFunction:function(e,t){this.makeDataRequest(LPProxy.getSharedFolderData,{params:{},success:function(t){!function(e,t,n){for(var i=LPProxy.getAllSharedGroupModelsByID(),o=[],r=0,s=e.length;r<s;++r){var a=e[r];if(a.sharedata){var l=i[a.shareid];o.push(new SharedFolderItem(l,a))}}t(o)}(t,e)}})},notificationCount:function(){return bg.get("g_pending_shares").length},sortOptions:h,menuElement:$("#sharedFoldersMenuItem"),contentID:"sharedFoldersContent",bodyState:"sharedFolders",scrollParent:C,searchPlaceholder:Strings.translateString("search my shared folders"),buildOptions:{multiSelect:!1},title:Strings.translateString("Shared Folders"),addMenu:[v.SharedFolder],additionalOptionButtons:[(de=$(LPTools.buildCheckbox(null,{text:Strings.translateString("View Deleted Shared Folders")})),de.attr("id","showDeletedSharedFoldersButton"),de.addClass("optionButtons"),de.bind("click",function(){et()}),de)]});Pe.initialize=function(e,t){var n;e=(n=e)?function(){Je({checkForStateChange:!1}),n()}:function(){Je({checkForStateChange:!1})},ie.prototype.initialize.call(this,e,t)};var ye=new se({menuElement:$(".sharingMenuItem"),defaultView:function(){return fe.notificationCount()>0?fe:LPProxy.getAccountClass()===Constants.USER_FREE?he:LPFeatures.allowSharedFolders()?Pe:fe},views:[Pe,he,fe]}),ve=(new ne({menuElement:$("#newSettingsMenuItem"),bodyState:"newSettings",title:Strings.translateString("Settings"),addMenu:null,scrollParent:$(document.body)}),function(){LPTools.hideContextMenu(J),J=null}),Se=function(e){e.preventDefault(),e.stopPropagation()},Ee=function(){ve(),Ke(),Ce(),De()},be=function(){ee&&ee.clearSelected()},Le=function(){q.val(""),be()},Te=function(e){return function(n){ve(),t.sort(e),Se(n)}},Ie=function(t){if(null!==t){LPTools.removeDOMChildren(Y);for(var n=0,i=t.length;n<i;++n){var o=e.createElement("li"),r=t[n];o.textContent=r,LPPlatform.addEventListener(o,"click",Te(r)),Y.appendChild(o)}x.show()}else x.hide()},Ce=function(){H.removeClass("selected"),T.hide("fast"),b.hide()},_e=function(){_.addClass("open")},De=function(){_.removeClass("open")};t.initialize=function(n){var i=$("#showReminders");bg.get("g_one_minute_signup_enabled")?oneMinuteSignup.fetchReminders():i.addClass("hidden"),bg.isOffline()?(i.attr("data-toggle","tooltip"),i.attr("title","You have to be online."),i.addClass("disabled")):(i.removeAttr("data-toggle"),i.removeAttr("title"),i.removeClass("disabled")),oneMinuteSignup.setOpenTourFn(t.openTour);try{if(bg.sendLpImprove("user_vault_opened"),e.body.removeAttribute("class"),Topics.get(Topics.REFRESH_DATA).publish(),$(".leftMenuItem").removeClass("selected"),LPProxy.getPreference("gridView")||t.displayAsList(),LPProxy.getPreference("compactView")&&t.displayCompact(),this.firstTimeLogin(),G.attr("title","Maximize Menu"),LPFeatures.allowGift()){var o=$("#specialOfferMenu");o.show(),o.bind("click",function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}Re(),LPPlatform.showIntroTutorial(),Oe(),xe(),LPFeatures.allowTryFamilies()&&$("#lp-try-families").show()}catch(e){LPPlatform.logException(e)}finally{var r=$("#vaultLoadingOverlay");LPTools.getOption(n,"fadeIn",!1)?(r.addClass("fadeIn"),setTimeout(function(){r.addClass("loaded")},500)):r.addClass("loaded"),V.addClass("loaded"),Me()}};var Ae,Fe,we,Me=function(){bg.sendTimingEvent("loadVault","start",window.performance.timing.navigationStart),bg.sendTimingEvent("loadVault","stop",window.performance.timing.loadEventEnd,{numberOfItems:LPProxy.getSites().concat(LPProxy.getNotes()).concat(LPProxy.getApplications()).length})},Oe=function(){var e=!1,t=function(){e?($("#inProgressMigration").hide(),Topics.get(Topics.REFRESH_DATA).publish(),setTimeout(LPPlatform.openTour,1)):e=!0};if(bg.MigrationBackground&&bg.MigrationBackground.subscribeToStateOnce){var n=function(e){e?($("#inProgressMigration").show(),setTimeout(t,3e3)):t(),bg.MigrationBackground.subscribeToStateOnce(n)};if(bg.MigrationBackground.subscribeToStateOnce(n),!LPPlatform.lpIsExtension()){var i=$("#inProgressMigration").find(".progress-bar");Migrator.executeMigrations(function(e,t){i.css("width",Math.floor(e/t*100)+"%")})}}},ke=function(){LPProxy.getPreference("leftMenuMaximize")&&t.toggleLeftMenu()},xe=function(){if(bg.get("g_one_minute_signup_menu_enabled")&&LPPlatform.lpIsExtension()){var e=bg.get("g_onemin_advert_app_threshold"),t=LPProxy.getAllModelItems().length;e&&t>e?$("#vaultFooter").addClass("disabled"):$("#vaultFooter").removeClass("disabled")}else $("#vaultFooter").addClass("disabled");$("#linkToOnemin","#vaultFooter").click(function(e){return bg.sendLpImprove("oneminute::notificationfromvaultomsstart"),oneMinuteSignup.show(oneMinuteSignup.modes.normal),!1})},Re=(Ae=function(e){t.openReceivedShareCenter(function(){var n=LPProxy.getPendingRecievedShare(e);n&&t.openAcceptShareDialog(n)})},Fe=function(e){t.openReceivedShareCenter(function(){var t=LPProxy.getPendingRecievedShare(e);t&&t.reject()})},we=function(e){for(var n=[],i=0,o=(e=e.split(",")).length;i<o;++i){var r=e[i],s=LPProxy.getSiteModel(r);s||(s=LPProxy.getNoteModel(r)),s&&n.push(s)}n.length>0&&t.openShareDialog(n)},function(){var e,n=LPTools.getURLParams();for(var i in LPPlatform.setIntroTutorialDisable(!1),n){var o=n[i];switch("cmd"===i&&(i=o),i){case"opengoogleauth":case"opensettings":Topics.get(Topics.EDIT_SETTINGS).publish();break;case"openhistory":LPProxy.openHistory();break;case"openbookmarklets":LPProxy.openBookmarklets();break;case"linkpersonal":t.openLinkAccountDialog();break;case"unlinkpersonal":t.unlinkAccount();break;case"sharedfolder":case"sf":t.openSharingCenter();break;case"sfadd":t.openSharingCenter(),t.openCreateSharedFolderDialog();break;case"addidentity":t.openManageIdentities(),t.openIdentityDialog();break;case"showdeleted":t.openDeletedItems();break;case"viewcreditmon":t.openCreditMonitoring();break;case"share":we(o);break;case"edit":e=o,LPProxy.getSiteModel(e)?t.openSiteDialog({vaultItem:e}):LPProxy.getNoteModel(e)&&t.openNoteDialog({vaultItem:e});break;case"acceptshare":Ae(o);break;case"rejectshare":Fe(o);break;case"omsstart":LPPlatform.setIntroTutorialDisable(!0),oneMinuteSignup.showWithProvider()}}null===ee&&function(e){switch(e){case"emergencyAccess":pe.show();break;case"emergencyAccessOthers":ge.show();break;default:rt.all.show()}}(n.view)}),Be=function(e){var t=LPPlatform.getOpenGroups();if(null!==t){for(var n=!0,i=e.getAllSubGroupsIncludingFavorites(!0),o=0,r=i.length;o<r;++o){var s=i[o];t[s._model.getName()]?(s.expand(),n=!1):s.collapse()}n&&Topics.get(Topics.ALL_COLLAPSED).publish()}},Ne=function(e){if(e){for(var t=e.getAllSubGroupsIncludingFavorites(!0),n=[],i=0,o=t.length;i<o;++i){var r=t[i];r.isExpanded()&&n.push(r._model.getName())}LPPlatform.setOpenGroups(n)}},$e=function(e){var t=$(".securityScore");t.text(null!==e?Math.round(e)+"%":""),e?t.parents(".menuIcon").addClass("score"):t.parents(".menuIcon").removeClass("score")};t.toggleInProgressOverlay=function(){L.toggle()};var Ge,Ue=function(e,t){t>0?(e.text(t),e.show()):e.hide()},ze=(Ge=!1,function(){if(!Ge)for(var e=LPProxy.getEmergencyAccessRecipientModels(),t=0,n=e.length;t<n;++t){var i=e[t];if(i.allowedAccess()||i.hasRequestedAccess()){dialogs.denyEmergencyAccess.open({sharee:i}),Ge=!0;break}}});t.openVault=function(){rt.all.show()},t.openNotes=function(){rt.notes.show()},t.openFormFills=function(){rt.formFill.show()},t.toggleAdvancedMenu=function(e){H.toggleClass("selected"),T.toggle("fast"),b.toggle(),Se(e)},t.clear=function(){E&&(E.destruct(),E=null),e.body.setAttribute("class","loggedout"+(LPPlatform.canBackgroundOpenPopover()?" canopenpopover":" cannotopenpopover")),$("#vaultLoadingOverlay").removeClass("loaded fadeIn"),Le(),ee=null,K=null,X=null,Z=null,J=null},t.maximizeLeftMenu=function(){V.addClass("maximized"),G.addClass("opened"),G.attr("title","Minimize Menu"),LPProxy.setPreferences("leftMenuMaximize",!0),setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)},t.minimizeLeftMenu=function(){V.removeClass("maximized"),G.removeClass("opened"),G.attr("title","Maximize Menu"),LPProxy.setPreferences("leftMenuMaximize",!1),setTimeout(Topics.get(Topics.VAULT_LEFT_MENU_TOGGLE).publish,400)},t.toggleLeftMenu=function(){V.hasClass("maximized")?t.minimizeLeftMenu():t.maximizeLeftMenu()},t.addSource=function(e){return e?e.saveOptions&&e.saveOptions.source||(e.saveOptions={source:"vault"}):e={saveOptions:{source:"vault"}},e},t.openSiteDialog=function(e){dialogs.site.open(t.addSource(e))},t.openTour=function(e){"41"===(bg.get("LPContentScriptFeatures")?bg.get("LPContentScriptFeatures").tutorial_enabled:"40")?LPPlatform.openTour(e):e?tt.show(e):LPProxy.getPreference("seenVault4.0")?(ke(),q.focus()):tt.show(e)},t.openNoteDialog=function(e){dialogs.note.open(t.addSource(e)),e&&e.vaultItem&&bg.loglogin(e.vaultItem._data.aid)},t.openFormFillDialog=function(e){dialogs.formFill.open(t.addSource(e))},t.openFolderDialog=function(e,t){dialogs.folder.open({vaultItem:e,defaultData:{groupParent:t?t.getName():""},groups:Z.getAllSubGroups()})},t.openTryFamiliesDialog=function(e,t){e=e||!1;var n=t?{origin:t}:{};bg.sendLpImprove("try_families_lightbox_shown",n),dialogs.tryFamilies.open({forceAccepted:e})},t.openUpgradeFamiliesForFolderSharingDialog=function(e){var t={forceAccepted:e||!1};bg.sendLpImprove("shared_folder_families_lightbox_shown"),dialogs.upgradeFamiliesForFolderSharing.open(t)},t.openFamiliesInvitationDialog=function(e){LPProxy.getFamiliesInvitations({params:{},success:function(t){t.length>0?(t.sort(function(e,t){return new Date(t.date)-new Date(e.date)}),dialogs.familiesInvitation.open({invitations:t,callback:e})):e(!1)},error:function(){e(!1)}})};var Ve,He,Ye=function(){var e=LPProxy.getAccountClass();return e===Constants.USER_FREE||e===Constants.USER_PREMIUM_TRIAL||e===Constants.USER_PREMIUM},qe=function(){var e=bg.localStorage_getItem("lp_families_dialog_snooze_timestamp"),t=bg.localStorage_getItem("lp_families_dialog_snooze_count");return e&&parseInt(e)>Date.now()&&(t&&"1"===t)},je=function(){var e=bg.localStorage_getItem("lp_try_families_dialog_declined"),t=bg.localStorage_getItem("lp_families_dialog_snooze_count"),n=t&&parseInt(t)>1;return e||n};t.openCreateSharedFolderDialog=function(e,n){!LPProxy.isLegacyPremium()&&Ye()&&LPFeatures.allowTryFamilies()&&!LPProxy.isFamiliesTrialStarted()?t.openUpgradeFamiliesForFolderSharingDialog(!1):LPProxy.isFamilyUser()&&bg.get("LPContentScriptFeatures").family_shared_folders_enabled?dialogs.familiesSharedFolder.open({group:e,children:n}):LPProxy.getAccountClass()===Constants.USER_FREE?(bg.sendLpImprove("upgrade_to_premium_lightbox_shown"),dialogs.upgradePremium.open({upgradeText:[LPTools.createElement("h1","upgradeDialogHeader",Strings.translateString("Need to share passwords with family or friends?")),LPTools.createElement("p","dialogText",Strings.translateString("Go Premium now to create a Shared Folder, invite family or friends, and fill the folder with passwords and notes. Give up to 5 people access to the Shared Folder. Changes are synced automatically, and you can assign read-only access. Go Premium now to create a Shared Folder!"))]})):dialogs.createSharedFolder.open({group:e,children:n})},t.openSettingsDialog=function(){null===K&&(AccountSettingsService.call(function(e){K=e,t.openSettingsDialog()},function(){Notifications.displayErrorMessage("Could not retrieve account settings!")}),Topics.get(Topics.DIALOG_LOADING).publish()),dialogs.settings.open(K)},t.openLinkAccountDialog=function(){LPProxy.callAcctsIFrameCommand("linkpersonal")},t.unlinkAccount=function(){var e=LPProxy.getLinkedAccount();e&&e.unlink()},t.toggleCollapseAll=(Ve=!1,Topics.get(Topics.ALL_COLLAPSED).subscribe(function(){Ve=!0,O.addClass("selected"),O.attr("title",Strings.Vault.EXPAND_ALL)}),Topics.get(Topics.ALL_EXPANDED).subscribe(function(){Ve=!1,O.removeClass("selected"),O.attr("title",Strings.Vault.COLLAPSE_ALL)}),function(){Ve?(Topics.get(Topics.EXPAND_ALL).publish(),Topics.get(Topics.ALL_EXPANDED).publish()):(Topics.get(Topics.COLLAPSE_ALL).publish(),Topics.get(Topics.ALL_COLLAPSED).publish())}),t.toggleSize=(He=!1,t.displayLarge=function(){Topics.get(Topics.DISPLAY_LARGE).publish(),He=!1,k.removeClass("selected"),k.attr("title",Strings.Vault.COMPACT_VIEW),LPProxy.setPreferences("compactView",!1)},t.displayCompact=function(){Topics.get(Topics.DISPLAY_COMPACT).publish(),He=!0,k.addClass("selected"),k.attr("title",Strings.Vault.LARGE_VIEW),LPProxy.setPreferences("compactView",!0)},function(){He?(t.displayLarge(),bg.lpevent(Q?"v_grd_lrg":"v_lst_lrg")):(t.displayCompact(),bg.lpevent(Q?"v_grd_cmp":"v_lst_cmp"))}),t.displayAsGrid=function(){Topics.get(Topics.DISPLAY_GRID).publish(),w.addClass("selected"),M.removeClass("selected"),LPProxy.setPreferences("gridView",!0),Q=!0},t.displayAsList=function(){Topics.get(Topics.DISPLAY_LIST).publish(),M.addClass("selected"),w.removeClass("selected"),LPProxy.setPreferences("gridView",!1),Q=!1},t.search=function(e){ee&&ee.search(e)};var We=function(e,t){switch(t){case r:e.sortByName(!0);break;case s:e.sortByName(!1);break;case i:e.sortByFolder(!0);break;case o:e.sortByFolder(!1);break;case a:e.sortItemsByMostRecent();break;case l:case u:e.sortByEmail(!0);break;case c:case d:e.sortByEmail(!1)}};t.sort=function(e){B.text(e),We(ee.getContainer(),e),ee.setSortOrder(e)};t.showMoreOptionsMenu=function(){U.show("fast")},t.hideMoreOptionsMenu=function(){U.hide("fast")};var Ke=function(){N.hide("fast"),j.removeClass("selected")};t.openEmergencyAccess=function(){me.show()},t.openEmergencyAccessTrusted=function(){me.show(pe)},t.openEmergencyAccessTrusting=function(){me.show(ge)},t.openSharingCenter=function(e){ye.show()},t.openReceivedShareCenter=function(e){ye.show(fe,e)},t.openSentShareCenter=function(e){ye.show(he,e)},t.openSharedFolderCenter=function(e){ye.show(Pe,e)};var Xe=!1,Qe=function(e){Pe.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(e){return!e._model.isDeleted()}},e),Xe=!1},Ze=function(e){Pe.getContainer().applyFilter({showEmptyGroups:!1,multiSelect:!1,func:function(e){return!0}},e),Xe=!0},Je=function(e){Xe?Ze(e):Qe(e)},et=function(){Xe?Qe():Ze()};t.openAcceptShareDialog=function(e){dialogs.acceptShare.open({vaultItem:e,groups:Z.getAllSubGroups()})},t.openShareDialog=function(e){LPTools.openShareDialog(e)},t.openSharedFolderDialog=function(e,t){LPProxy.isFamilyUser()&&e._shareInfo.cid!==Constants.UNAFFILIATED_COMPANY_ID&&bg.get("LPContentScriptFeatures").family_shared_folders_enabled?dialogs.familiesSharedFolder.open({folder:e,members:t}):dialogs.sharedFolder.open(e,t)},t.openSharedFolderAccessDialog=function(e){dialogs.sharedfolderAccess.open(e)},t.openRestrictedSharingDialog=function(){dialogs.restrictedSharing.open()},t.closeShareDialog=function(){dialogs.share.close(!0)},t.openManageIdentities=function(){ae.show()},t.openIdentityDialog=function(e){dialogs.identity.open(e)},t.enableIdentity=function(t){null!==X&&X!==t&&(X.disable(),LPProxy.enableIdentity(t)),X=t;var n=Z?Z._filter:null;null!==Z&&(Ne(Z),Z.destruct()),Z=function(t,n){var i=LPProxy.getAllItems({identity:t}),o=new GridListContainer(i,{separateItems:!0,separateFavorites:!0,stickyFolders:!0,ignoreFilterOnSearch:!0,keyboardNavigation:!0,stickyFolderParent:e.getElementById("main"),folderStateChange:Ne});for(var r in Be(o),We(o,rt.all.getSortOrder()),o.initialize(e.getElementById("vaultContent"),C),o.applyFilter(n),st(o),rt)rt[r].setContainer(o);return o}(X,n)},t.openCreditMonitoring=function(e){le.show()},t.openCreateCreditMonitoringDialog=function(){dialogs.createCreditMonitoring.open()},t.openDeletedItems=function(e){ce.show()};var tt=function(){var t=0,n=null,i=null,o=e.getElementById("tourItems"),r=$("#tourLeft"),s=$("#tourRight"),a="tourState";r.hide(),r.bind("click",function(){tt.reverse()}),s.bind("click",function(){tt.advance()});for(var l=function(e){return function(){tt.goTo(e)}},c=0,u=(i=e.getElementById("tourSteps").children).length;c<u;++c)LPPlatform.addEventListener(i[c],"click",l(c));i[0].setAttribute("class","tourStep selected");var d=function(e){if(e!==t&&e>=0&&e<i.length){i[t].setAttribute("class","tourStep");var a="tour"+(e+1);o.setAttribute("class",a),V.addClass(a),n&&V.removeClass(n),n=a,i[t=e].setAttribute("class","tourStep selected"),0===e?r.hide():r.show(),e===i.length-1?s.hide():s.show()}},p=function(){d(t+1)},g=function(){d(t-1)};return{advance:p,reverse:g,goTo:function(e){d(e)},hide:function(){V.removeClass(a),V.removeClass(n),n=null,Topics.get(Topics.RIGHT_ARROW).unsubscribe(p),Topics.get(Topics.LEFT_ARROW).unsubscribe(g),bg.sendLpImprove&&bg.sendLpImprove("vaulttour::exit",{version:"40",page:t+1})},show:function(e){d(0),V.addClass(a),Topics.get(Topics.RIGHT_ARROW).subscribe(p),Topics.get(Topics.LEFT_ARROW).subscribe(g),bg.sendLpImprove&&(bg.sendLpImprove("vaulttour",{version:"40"}),bg.sendLpImprove("vaulttour::start",{version:"40",source:e?"help":"welcome"}))}}}();t.showAdPane=function(){if(void 0!==bg.is_edge?bg.is_edge():-1!==navigator.userAgent.indexOf(" Edge/"))return!1;var t=bg.get("g_prompts").improve?1:0,i=e.getElementById("ad"),o=e.createElement("iframe");o.setAttribute("src",n.getPartnerURL(LPProxy.getBaseURL()+"ads.php?nobr=1&noga=1&rand="+Math.floor(1e3*Math.random())+"&v="+LPProxy.getVersion())+"&g_lpImprove="+t),o.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups"),i.appendChild(o),V.addClass("freeUser"),setInterval(function(){o.setAttribute("src",n.getPartnerURL(LPProxy.getBaseURL()+"ads.php?v=4.0&nobr=1&noga=1&rand="+Math.floor(1e3*Math.random())+"&v="+LPProxy.getVersion())+"&g_lpImprove="+t)},3e5)},t.firstTimeLogin=function(){if(bg.get("g_first_time_login")){var e=LPTools.createElement("iframe",{class:"displaynone",src:LPProxy.getBaseURL()+"lppixel.php"});$("#main").after(e)}},V.bind("click",function(){Ee()}),$("#vault").bind("click",function(){be(),Ee()}),$("#loginButton").bind("click",function(){bg.open_login()}),LPPlatform.addEventListener(window,"unload",function(){Topics.get(Topics.CLEAR_DATA).publish()}),q.LP_addSearchHandlers("inputLight",function(e){t.search(e)}),q.bind("keydown",function(e){if(40===(e.keyCode||e.which)){var t=ee.getContainer();if(t){var n=t.getAllChildrenOrdered();n.length>0&&(n[0].focus(),e.preventDefault(),e.stopPropagation())}}}),$("#orderOption").bind("click",function(e){R.toggle("fast"),J=R,LPTools.addKeyBoardNavigation(Y.children),Se(e)}),$("#actions").bind("click",function(e){if(null===J||J.get(0).parentElement!==z){var t=ee.createSelectionContextMenu();z.appendChild(t),t.removeAttribute("style"),(J=$(t)).show("fast")}else ve();Se(e)}),$(".sharingMenuItem").bind("click",function(){bg.sendLpImprove("sharing_center_vault_click"),!LPProxy.isLegacyPremium()&&Ye()&&LPFeatures.allowTryFamilies()&&!je()&&!qe()&&LPProxy.isFamiliesTrialStarted()&&t.openTryFamiliesDialog(!1,"sharing_menu_item"),t.openSharingCenter()}),H.bind("click",t.toggleAdvancedMenu),b.bind("click",Ce),G.bind("click",t.toggleLeftMenu),LPPlatform.addEventListener(e.getElementById("settingsMenuItem"),"click",function(){Topics.get(Topics.EDIT_SETTINGS).publish({source:"sidebar"})}),$("#linkAccountMenuItem").bind("click",function(){t.openLinkAccountDialog()}),T.on("click",".toolsMenuItem.subMenuOption",function(){return!1}),T.on("click",".toolsMenuItem",Ce),_.bind("mouseenter",_e),_.bind("mouseleave",De),_.bind("touchstart",function(e){_.unbind("mousenter"),_.unbind("mouseleave"),_.hasClass("open")||(_e(),e.preventDefault())}),LPPlatform.addEventListener(e.getElementById("collapseAllToggle"),"click",function(){t.toggleCollapseAll()}),LPPlatform.addEventListener(e.getElementById("showReminders"),"click",function(){oneMinuteSignup.show(oneMinuteSignup.modes.reminder)}),LPPlatform.addEventListener(e.getElementById("sizeToggle"),"click",function(){t.toggleSize()}),LPPlatform.addEventListener(e.getElementById("gridButton"),"click",function(){t.displayAsGrid()}),LPPlatform.addEventListener(e.getElementById("listButton"),"click",function(){t.displayAsList()}),LPPlatform.addEventListener(e.getElementById("userMenuContainer"),"click",function(e){j.toggleClass("selected"),N.toggle("fast"),Se(e)});var nt,it=function(){tt.hide(),LPProxy.getPreference("seenVault4.0")||LPProxy.setPreferences("seenVault4.0",!0),ke()};LPPlatform.addEventListener(e.getElementById("skipTour"),"click",it),LPPlatform.addEventListener(e.getElementById("tourOpenMyVault"),"click",it),LPPlatform.addEventListener(e.getElementById("manageIdentitiesMenuItem"),"click",function(){t.openManageIdentities()}),LPPlatform.addEventListener(e.getElementById("creditMonitoringMenuItem"),"click",function(){t.openCreditMonitoring()}),LPPlatform.addEventListener(e.getElementById("openTourMenuItem"),"click",function(){t.openTour(!0)}),$(".toolsMenuItem.subMenuOption").bind("click",function(e){$(e.target.parentElement.nextElementSibling).toggle("fast"),$(e.target).toggleClass("selected"),Se(e)}),LPPlatform.addEventListener(e.getElementById("toolsImport"),"click",function(){LPProxy.import()}),LPPlatform.addEventListener(e.getElementById("toolsExport"),"click",function(){LPProxy.export()}),LPPlatform.addEventListener(e.getElementById("toolsOpenFavorites"),"click",function(){LPProxy.openAllFavorites("vault")}),LPPlatform.addEventListener(e.getElementById("bookmarkletsMenuItem"),"click",function(){LPProxy.openBookmarklets()}),LPPlatform.addEventListener(e.getElementById("historyMenuItem"),"click",function(){LPProxy.openHistory()}),LPPlatform.addEventListener(e.getElementById("deletedMenuItem"),"click",function(){t.openDeletedItems()}),LPPlatform.addEventListener(e.getElementById("generateSharingKeys"),"click",function(){bg.lpevent("v_gsk"),dialogs.sharingKey.open()}),$("#generateSharingKeys").hide(),LPPlatform.addEventListener(e.getElementById("featureManager"),"click",function(){bg.openURL(window.location.origin+"/lastpass/index.html#/feature-manager")}),LPPlatform.addEventListener(e.getElementById("generatePasswordMenuItem"),"click",function(){bg.lpevent("v_gpw"),(bg.get("LPContentScriptFeatures").better_generate_password_enabled?dialogs.betterGeneratePassword:dialogs.generatePassword).open({fillGenerated:!1,saveOptions:{source:"vault"}})}),$("#removedLinkedAccountMenuItem").bind("click",function(){t.unlinkAccount()}),$("#tryEnterprise").bind("click",function(){dialogs.enterpriseTrial.open()}),$("#emergencyAccessMenuItem").bind("click",function(){var e=LPProxy.getUser(),n=bg.get("g_emer_sharers"),i=bg.get("g_emer_sharees");e.isFree()&&LPFeatures.restrictEmergencyAccessForFree()&&!n.length&&!i.length?dialogs.restrictedEmergencyAccess.open():(bg.sendLpImprove("emergency_access_vault_click"),t.openEmergencyAccess())}),$(".securityMenuItem").bind("click",function(){bg.lpevent("v_sec"),bg.openseccheck()}),$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("v_oec"),bg.openentconsole()}),$("#more-options-refer-a-friend").bind("click",function(){bg.sendLpImprove("refer_a_friend_more_options_click")}),$("#more-options-go-premium").bind("click",function(){bg.sendLpImprove("go_premium_more_options_vault_click")}),$("#familyAdminConsoleMenuItem").bind("click",function(){bg.lpevent("v_ofc"),bg.openFamilyConsole(),bg.sendLpImprove("families_manage_families_click")}),$("#lp-try-families").bind("click",function(){Ye()&&LPFeatures.allowTryFamilies()&&t.openTryFamiliesDialog(!1,"try_families_submenu_item")}),Topics.get(Topics.ITEMS_DESELECTED).subscribe(function(){t.hideMoreOptionsMenu()}),Topics.get(Topics.ITEMS_SELECTED).subscribe(function(){t.showMoreOptionsMenu()}),Topics.get(Topics.SELECT_COUNT_CHANGE).subscribe(function(e){!function(e){if(e>0){var t=e+" selected";$("#selectedItemCounter").text(t)}}(e)}),Topics.get(Topics.CONTEXT_MENU).subscribe(function(t,n){n.parentElement!==e.body&&e.body.appendChild(n),J=LPTools.displayContextMenu(t,n)}),Topics.get(Topics.CONTEXT_CLOSE).subscribe(function(){ve()}),Topics.get(Topics.ITEM_SHARE).subscribe(function(e){LPFeatures.allowOmarDrawer()&&1===e.length?window.location.hash="/drawers/(drawer:edit-item/"+e[0]._data.aid+"/sharing)":t.openShareDialog(e)}),Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(e){t.enableIdentity(e),st(Z)}),Topics.get(Topics.CLEAR_DATA).subscribe(function(){t.clear(),Dialog.prototype.closeAllDialogs(!0),LPProxy.closeIFrame()}),Topics.get(Topics.LOGIN).subscribe(function(e){at(),t.initialize(e),Dialog.prototype.closeAllDialogs()}),Topics.get(Topics.REQUEST_SUCCESS).subscribe(function(e){LPTools.getOption(e,"incrementAccountsVersion",!1)&&be()}),nt=function(e,t,n){Le(),Z.addChild(e.newDisplayObject(),t,n),st(Z)},Topics.get(Topics.SITE_ADDED).subscribe(nt),Topics.get(Topics.NOTE_ADDED).subscribe(nt),Topics.get(Topics.FORM_FILL_ADDED).subscribe(nt),Topics.get(Topics.APPLICATION_ADDED).subscribe(nt),Topics.get(Topics.ITEM_REMOVED).subscribe(function(){st(Z)}),Topics.get(Topics.EDIT_SHARED_FOLDER_ACCESS).subscribe(function(e){t.openSharedFolderAccessDialog(e)}),Topics.get(Topics.EDIT_SITE).subscribe(function(e){LPFeatures.allowOmarDrawer()?window.location.hash="/drawers/(drawer:edit-item/"+e.vaultItem._data.aid+")":t.openSiteDialog(e)}),Topics.get(Topics.EDIT_NOTE).subscribe(function(e){LPFeatures.allowOmarDrawer()?window.location.hash="/drawers/(drawer:edit-item/"+e.vaultItem._data.aid+")":t.openNoteDialog(e)}),Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(e){t.openFormFillDialog(e)}),Topics.get(Topics.EDIT_APPLICATION).subscribe(function(e){dialogs.application.open(e)}),Topics.get(Topics.EDIT_SETTINGS).subscribe(function(e){bg.sendLpImprove("viewvaultsettings",{source:e&&e.source?e.source:""}),LPProxy.callAcctsIFrameCommand("settings")}),Topics.get(Topics.EDIT_IDENTITY).subscribe(function(e){t.openIdentityDialog(e)}),Topics.get(Topics.ACCEPT_SHARE).subscribe(function(e){t.openAcceptShareDialog(e)}),Topics.get(Topics.RENAME_FOLDER).subscribe(function(e){t.openFolderDialog(e)}),Topics.get(Topics.CREATE_SUB_FOLDER).subscribe(function(e){t.openFolderDialog(null,e)}),Topics.get(Topics.GROUP_ADDED).subscribe(function(e,t){if(Le(),Z.addChild(e.newDisplayObject(),t),e instanceof SharedGroup){var n=Pe.getContainer();if(null!==n){var i=new SharedFolderItem(e);n.addChild(i)}}}),Topics.get(Topics.ESCAPE).subscribe(function(e){var t=Dialog.prototype.getCurrentDialog();t&&t.close(),be(),Ee()}),Topics.get(Topics.EDIT_SHARED_FOLDER).subscribe(function(e,n){t.openSharedFolderDialog(e,n)}),Topics.get(Topics.IDENTITY_ADDED).subscribe(function(e){ae.getContainer().addChild(e.newDisplayObject())}),Topics.get(Topics.REFRESH_DATA).subscribe(function(){var n,i;LPProxy.initializeModel(),ze(),(E=LPProxy.getUser()).initialize(N,$("#userMenuText")),LPTools.parseUserSpecificMenu(e.getElementById("tools"),E._accountClass),LPTools.parseUserSpecificMenu(e.getElementById("leftMenu"),E._accountClass),n=LPProxy.getAccountClass(),i=e.getElementById("sharedFoldersMenuItem").parentElement,n===Constants.USER_FREE&&($("#emptySharedFoldersIcon .tourText").append(LPTools.createElement("a",{class:"nbtn rbtn dynamicWidth",href:LPProxy.getBaseURL()+"go-premium",target:"_blank"},Strings.translateString("Upgrade to Premium"))),i.parentElement.appendChild(i)),$(i.parentElement).children().last().addClass("last"),VaultState.setIdentities(E._identities),LPProxy.enableCurrentIdentity(E._identities),E.isFreeOrTrial()?t.showAdPane():V.removeClass("freeUser"),LPProxy.getSecurityChallengeScore($e),Dialog.prototype.closeInProcessDialogs(),VaultItemDialog.prototype.refreshOpenDialogs(),Topics.get(Topics.REFRESH_PREFERENCES).publish(),ve()}),Topics.get(Topics.UPDATE_NOTIFICATION_COUNT).subscribe(function(e){ee&&ee.updateNotificationCount("number"==typeof e?e:1)}),Topics.get(Topics.ACCOUNT_LINKED).subscribe(function(e){$("#linkAccountMenuItem").LP_hide(),$("#removedLinkedAccountMenuItem").LP_show()}),Topics.get(Topics.ACCOUNT_UNLINKED).subscribe(function(e){$("#linkAccountMenuItem").LP_show(),$("#removedLinkedAccountMenuItem").LP_hide()}),Topics.get(Topics.CREATE_SHARED_FOLDER).subscribe(function(e,n){t.openCreateSharedFolderDialog(e,n)}),Topics.get(Topics.REPROMPT).subscribe(function(e){dialogs.reprompt.open({successCallback:e})}),Topics.get(Topics.CONFIRM).subscribe(function(e){dialogs.confirmation.open(e)}),Topics.get(Topics.EMERGENCY_RECIPIENT_ADDED).subscribe(function(e){pe.getContainer().addChild(e.newDisplayObject())}),Topics.get(Topics.EDIT_EMERGENCY_RECIPIENT).subscribe(function(e){dialogs.addEmergencyAccess.open({vaultItem:e})}),Topics.get(Topics.REAPPLY_SEARCH).subscribe(function(e,t){var n=q.val();n&&e.applySearch(n,t)}),Topics.get(Topics.ENROLLED_CREDIT_MONITORING).subscribe(function(){le.refresh()}),Topics.get(Topics.ITEM_SHARED).subscribe(function(e){he.refresh()}),Topics.get(Topics.REFRESH_PREFERENCES).subscribe(function(){switch(LPFeatures.updateFeatures({import:!0,noexport:!1,share:!0,share_onlyfolders:!1,show_notes:!0,bookmarklets:!0,hideidentities:!1,showcredmon:!0,link_personal:!0,show_formfills:!0}),LPProxy.hasReceivedShares()?V.removeClass("noReceivedShares"):V.addClass("noReceivedShares"),ee){case he:LPFeatures.allowIndividualSharing()||(ye.clear(),rt.all.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited individual sharing.")}));break;case Pe:LPFeatures.allowSharedFolders()||(rt.all.show(),dialogs.alert.open({title:Strings.translateString("Policy Update"),text:Strings.translateString("Your enterprise has prohibited sharing.")}))}}),Topics.get(Topics.INITIALIZED).subscribe(function(){if(Strings.translate(e.body),$("input,textarea").prop("spellcheck",!1),LPFeatures.allowNewSettings()){var t=document.getElementById("new-settings-iframe");t.src=LPProxy.getBaseURL()+"newvault/lp-vault/settings.html",t.addEventListener("load",function(){t.contentWindow.postMessage({localkey:parent.g_local_key},LPProxy.getBaseURL())})}}),Topics.get(Topics.INTRO_TOURS_LOADED).subscribe(function(e){var n=LPProxy.seenVaultPostFamilies(),i=LPProxy.predatesFamilies(),o=LPFeatures.allowTryFamilies(),r=LPProxy.isFamiliesTrialStarted();!o||!i||n||je()||qe()||!Ye()||r||t.openTryFamiliesDialog(!1,"first_vault_entry")}),LPPlatform.addEventListener(e,"DOMContentLoaded",function(){Notifications.initialize()});var ot=function(e,t){if(e.types){var n=t.filter(function(t){return e.types.indexOf(t.id)>-1});return function(e){for(var t=0;t<n.length;++t)if(i=e,o=n[t],i instanceof GroupDisplay||i._model.getRecordType()===o.recordType)return!0;var i,o;return!1}}return function(e){return!(e instanceof FormFillDisplay)}},rt={},st=function(e){if(LPFeatures.allowOmarIA()){var t=document.getElementById("leftMenuItemsContainer");LPTools.removeDOMChildren(t);var n=LPProxy.getRecordConfig(),i=!1,o=!1,r=function(e){i&&(t.appendChild(LPTools.createElement("div","leftMenuItemsDivider")),i=!1),t.appendChild(rt[e].getElement())},s=function(t,a){if(Array.isArray(t))i=a>0,t.forEach(s);else{var l=LPProxy.getConfigViewObject(t);if(l.default)r(t);else{var c=ot(l,n.types),u=e._filter;e.applyFilter({func:c},{checkForStateChange:!1}),e.getItemChildren().length>0?r(t):rt[l.id]===ee&&(o=!0),e.applyFilter(u,{checkForStateChange:!1})}}};i=!0,n.viewConfig.forEach(s),o&&rt.all.show()}},at=function(){if(LPFeatures.allowOmarIA()){var e=LPProxy.getRecordConfig();e.views.forEach(function(t){var n,i,o,r,s,a,l;rt[t.id]=new oe({filter:{showEmptyGroups:!1,func:ot(t,e.types)},sortOptions:p,menuElement:(n=t.name,s=t,l=LPProxy.getRecordConfig(),a=s.types&&s.types.length>0?l.icons[s.types[0]]:l.icons.all,i=LPTools.createElement("i",{class:["menuIcon",a]}),o={id:t.id},r=LPTools.createElement("div",$.extend(o,{class:"leftMenuItem",id:o.id})),r.appendChild(i),r.appendChild(LPTools.createElement("span",{class:"menuText"},n)),$(r)),bodyState:"vaultContent "+t.id,scrollParent:C,title:Strings.translateString(t.name),addMenu:[new y({text:"ADD_ITEM",func:function(){dialogs.addItem.open()}}),v.Folder]})})}else rt.all=new oe({filter:{showEmptyGroups:!0,func:function(e){return e instanceof AccountBaseDisplay||e instanceof ApplicationDisplay||e instanceof GroupDisplay}},sortOptions:p,menuElement:$("#vaultMenuItem"),bodyState:"vaultContent site",scrollParent:C,title:Strings.translateString("Sites"),addMenu:[v.Site,v.Note,v.ShareItems,v.Folder]}),rt.notes=new oe({filter:{showEmptyGroups:!1,func:function(e){return e instanceof NoteDisplay||e instanceof GroupDisplay}},sortOptions:p,menuElement:$("#notesMenuItem"),bodyState:"vaultContent note",scrollParent:C,title:Strings.translateString("Secure Notes"),addMenu:[v.Note,v.ShareItems,v.Folder]}),rt.formFills=new oe({filter:{showEmptyGroups:!1,multiSelect:!1,hasFolderView:!1,func:function(e){return e instanceof FormFillDisplay}},sortOptions:g,menuElement:$("#formFillMenuItem"),bodyState:"vaultContent formFill",scrollParent:C,title:Strings.translateString("Form Fills"),addMenu:[v.FormFill]});LPFeatures.isDogfood()||$("#featureManager").LP_hide()}}(document,LPVault,BuildVariables);
//# sourceMappingURL=sourcemaps/vault.js.map
