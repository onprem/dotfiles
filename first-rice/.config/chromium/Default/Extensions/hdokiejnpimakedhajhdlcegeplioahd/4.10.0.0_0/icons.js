function checkIconsVersion(n){var e=opendb();if(createDataTable(e),e){var s=function(e,s){var o=!0,i=null;lpGetPref("icons",-1);s.rows.length>0&&(lpGetPref("icons",-1)==n&&(o=!1,i=s.rows.item(0).data));null==i||o?downloadIcons():processIcons(i)};if(g_indexeddb){var o={rows:{item:function(n){return this[n]},length:0}};e.transaction("LastPassData","readonly").objectStore("LastPassData").openCursor(IDBKeyRange.only(db_prepend(g_username_hash)+"_icons")).onsuccess=function(n){var e=n.target.result;e?(o.rows[o.rows.length]=e.value,o.rows.length++,e.continue()):s(0,o)}}else e.transaction(function(n){n.executeSql("SELECT * FROM LastPassData WHERE username_hash=? AND type=?",[db_prepend(g_username_hash),"icons"],s,function(n,e){console_log(e)})})}else downloadIcons()}function downloadIcons(){lpMakeRequest(base_url+"geticon.php","versionchrome=1&username="+en(g_username),lpIconResponse,null)}function downloadBigIcons(n,e){e=e||"big";var s="big=1&versionchrome=1&username="+en(g_username)+"&size="+("big"===e?"s":e);n&&(s+="&domain="+en(n)),lpMakeRequest(base_url+"geticon.php",s,function(n){if(4==n.readyState&&200==n.status&&n.responseText){if("latest"==n.responsetext||"nodata"==n.responsetext)return;processIcons(n.responseText,e),saveBigIcons(e)}},null)}function lpIconResponse(n){if(4==n.readyState&&200==n.status&&n.responseText){if("latest"==n.responsetext||"nodata"==n.responsetext)return;var e=n.responseText.split("\n"),s=e[0].split("=")[1],o=e[1];lpPutUserPref("icons",s),lpWriteAllPrefs(),lpSaveData(o,"icons"),processIcons(o)}}function getBigIconKeyIfMissing(n,e){var s="sq"===(e=e||"big")?g_bigsquareicons:g_bigicons;null==BigIconList&&LoadBigIconList();var o=hostof(n),i=AES.bin2hex(o);if(void 0!==BigIconList[i])return void 0===s[o]?o:null;var t=lp_gettld_url(n),r=AES.bin2hex(t);return void 0!==BigIconList[r]&&void 0===s[t]?t:null}function checkBigIconsVersion(n,e,s,o){var i=!0,t="sq"===(o=o||"big")?g_bigsquareicons:g_bigicons;for(var r in t){i=!1;break}if(!i||e)if(n)null!=(u=getBigIconKeyIfMissing(n,o))&&downloadBigIcons(u,o);else{var a=!1,c=[],l=[];for(var g in g_sites){var u;if(a=!0,null!=(u=getBigIconKeyIfMissing(g_sites[g].url,o))){if(void 0!==l[u])continue;l[u]=1,c[c.length]=u}}a||s?c.length&&downloadBigIcons(c.join(","),o):downloadBigIcons("all",o)}else LPPlatform.getBigIcons(function(e){e?(processIcons(e,o),checkBigIconsVersion(n,!0,s,o)):downloadBigIcons("all",o)},o)}function processIcons(n,e){var s=null;if(n&&(n=n.split(":"),e&&(s="sq"===e?g_bigsquareicons:g_bigicons),n.length)){var o=n[0],i=0;for(e=n.length;i+1<e;i+=2){var t=parseInt(n[i+1]);if(0===o.indexOf("lp")&&t>0){o=o.substring(2);var r=n[i+2].substring(0,t);e?s[AES.hex2bin(o)]=r:g_icons[o]=r,o=n[i+2].substring(t)}}}LPPlatform.updateBigIcons(s)}function saveBigIcons(n){var e="sq"===n?g_bigsquareicons:g_bigicons,s="";for(var o in e){var i=e[o];s+="lp"+AES.bin2hex(o)+":"+i.length+":"+i}LPPlatform.saveBigIcons(s,n)}
//# sourceMappingURL=sourcemaps/icons.js.map
