var CS_table=[];function CS_t(){}function getcsid(n,t){return("function"==typeof lp_sha256?lp_sha256:SHA256)(n+""+t)}function getcsinfo(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=getcsid(n,t);if(null===e)return null;var i=CS_table[e];return void 0===i&&(i=null),i}function setcsinfo(n,t,e){if(null===n||null===t||!e||void 0===n||void 0===t)return null;if(null===e.docnum||null===e.tabid||null===e.url)return null;"number"==typeof n&&(n=n.toString());var i=getcsid(n,t);return e.csid&&i&&i!=e.csid&&L("warn: csid!=obj.csid"),null!==e.csid&&void 0!==e.csid||(e.csid=i),e.last_ts=(new Date).getTime(),void 0===CS_table&&(CS_table=[]),CS_table[i]=e,!0}function register_new_cs(n,t,e,i,o,r){if(null===n||null===t||!e||void 0===n||void 0===t)return null;write_history({cmd:"register_new_cs",docnum:t,tabid:n,docstate:o}),void 0===o&&(o=null),void 0===r&&(r=null),"number"==typeof n&&(n=n.toString());var l=0,u=new CS_t;if(u){if(u.docnum=t,u.tabid=n,u.url=e,u.lastfill_aid=0,i?u.parent_docnum=t:(u.parent_docnum=g_CS_tops[n],u.parent_docnum),u.docstate=o,u.flags=null,null!==r&&"object"==typeof r&&(u.flags=r,void 0!==r.domain&&(u.domain=r.domain,delete u.flags.domain),void 0!==r.origin&&(u.origin=r.origin,delete u.flags.origin)),u.start_ts=(new Date).getTime(),g_cpwbot&&CPWbot_bg){var a={url:e,docnum:t};l=CPWbot_bg.score_frame(n,a)}return u.importance=l,setcsinfo(n,t,u)}return null}function delete_cs_for_docnum(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e,i=!1;for(e in CS_table)CS_table.hasOwnProperty(e)&&e==getcsid(n,t)&&(i=!0,delete CS_table[e]);return i}function delete_cs_for_tab(n){if(null===n||void 0===n)return null;"number"==typeof n&&(n=n.toString());var t,e=!1;for(t in CS_table)if(CS_table.hasOwnProperty(t)){var i=CS_table[t];i&&i.tabid==n&&(e=!0,delete CS_table[t])}return e}function update_cs_docstate(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var i=t.docstate;if(null===i||void 0===i)return null;var o=!1,r=getcsinfo(n,e);return r&&(r.docstate=i,o=setcsinfo(n,e,r)),o}function update_cs_timestamp(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var i=getcsinfo(n,e);return i?setcsinfo(n,e,i):null}function count_cs_for_tabid(n){if(null===n||void 0===n)return-1;"number"==typeof n&&(n=n.toString());var t,e=0;for(t in CS_table)CS_table.hasOwnProperty(t)&&CS_table[t].tabid===n&&e++;return e}function dumpinfo_for_tabid(n){var t,e,i;if(null!==n&&void 0!==n)for(e in"number"==typeof n&&(n=n.toString()),console.log("dumping info for tabid="+n),CS_table)CS_table.hasOwnProperty(e)&&(i=CS_table[e],t=(new Date).getTime(),i.tabid===n&&console.log("DUMPINFO [tabid:"+n+"][docnum:"+i.docnum+"] url="+i.url+" last_ts="+(t-i.last_ts)/1e3+"secs score="+i.importance+" killswitch?="+i.killswitch+" isTop?="+(i.parent_docnum==i.docnum?"true":"false")))}function find_docnum_for_tabid_by_url(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;var e,i,o;for(e in"number"==typeof n&&(n=n.toString()),CS_table)if(CS_table.hasOwnProperty(e)&&(o=CS_table[e]).tabid===n&&o.url==t){i=o.docnum;break}return i}function set_killswitch_value(n,t,e){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var i=getcsinfo(n,t);return!!i&&(i.killswitch=e,setcsinfo(n,t,i))}function get_killswitch_value(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=getcsinfo(n,t),i=0;return e&&(i=parseInt(e.killswitch),isNaN(i)&&(i=0)),i}function skip_CS_by_score(n,t){if(null===n||null===t)return!0;var e=getcsinfo(n,t);return!e||(L("skip? [tabid="+n+"][docnum="+t+"] score="+e.importance),e.importance<-25)}function get_top_url(n,t){var e="",i=getcsinfo_top(n,t);if(i&&i.parent_docnum==i.docnum)e=i.url;else for(var o in CS_table)if(CS_table.hasOwnProperty(o)&&(i=CS_table[o]).tabid===n&&i.parent_docnum==i.docnum){e=i.url;break}return e}function get_top_docnum(n,t){var e=0;i;var o=getcsinfo_top(n,t);if(o&&o.parent_docnum==o.docnum)e=o.docnum;else for(var r in CS_table)if(CS_table.hasOwnProperty(r)&&(o=CS_table[r]).tabid===n&&o.parent_docnum==o.docnum){e=o.docnum;break}return e}function update_cs_docflags(n,t){if(null===n||null===t||void 0===n||void 0===t)return null;"number"==typeof n&&(n=n.toString());var e=t.docnum;if(null===e||void 0===e)return null;var i=t.docflags,o=!1,r=getcsinfo(n,e);return r&&"object"==typeof i&&(r.flags=i,void 0!==i.domain&&(r.domain=i.domain,delete r.flags.domain),void 0!==i.origin&&(r.origin=i.origin,delete r.flags.origin),o=setcsinfo(n,e,r)),o}function getcsinfo_top(n,t){for(var e=null,i=-1,o=getcsinfo(n,t),r=null,l=0;l<10&&o;l++){if((r=getcsinfo(n,o.parent_docnum))&&o.parent_docnum==r.docnum){i=r.docnum;break}if(null==o.parent_docnum)break;o=r}return i>=0&&(r=getcsinfo(n,i)),r&&!isEmptyObject(r)&&(e=r),e}function update_cs_lastfill_aid(n,t){var e=!0;if(null===n||void 0===n||void 0===t)return!1;"number"==typeof n&&(n=n.toString());var i=get_top_docnum(n),o=getcsinfo(n,i);return o&&(o.lastfill_aid=t,e=setcsinfo(n,i,o)),e}function rebuild_cs_table(n){function t(t){if(0!=t.url.indexOf("chrome:")&&0!=t.url.indexOf("safari:")){var e=gettabid(t);for(var i in g_CS[e]){var o=i,r=(g_CS[e][i],gettaburl(t)),l=t.status,u=!1;if(i&&g_CS_tops[e]==i&&(u=!0),n){var a=getcsinfo(e,o);a?(r!=a.url&&console.log(sprintf("[%s][%s] url mismatch %s != %s",e,o,r,a.url)),u!=(a.parent_docnum==a.docnum)&&console.log(sprintf("[%s][%s] isTop mismatch %s != %s ",e,o,r,u,a.parent_docnum==a.docnum))):console.log(sprintf("[%s][%s] seems like this frame exists but no entry found in CS table for it",e,o))}else register_new_cs(e,o,r,u,l,0)}}}get_all_windows({},function(n){var e,i;for(e=0;e<n.length;e++)if(g_ischrome)chrome.tabs.query({windowId:n[e].id},function(n){if(n&&n.length>0)for(var e=0;e<n.length;e++){t(n[e])}});else{var o=get_tabs(n[e]);if(o&&void 0!==o.length)for(i=0;i<o.length;i++)t(o[i])}})}
//# sourceMappingURL=sourcemaps/csid.js.map
